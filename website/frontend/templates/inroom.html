{% extends "base.html" %}
{% comment %}
-*- coding: utf-8 -*-
vim: set ts=2 sw=2 et sts=2 ai:
{% endcomment %}

{% block head %}
    <script type="text/javascript" src="/static/third_party/jquery-extra/jquery.juitter-1.0.0.js"></script>
    <script type="text/javascript" src="/static/js/whats_on.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="stylesheet" type="text/css" href="/static/css/tweet.css">
    <link rel="stylesheet" type="text/css" href="/static/third_party/jquery-extra/jquery.juitter-1.0.0.css">
    <title>Streaming for {{ config.title }}</title>
{% endblock %}

{% block content %}
      <td id="abstract_cell abstract_cell_group" colspan=2 style="height: 1px;">
        <div id="showing" class='abstract_div abstract_div_group'>
          <div id='abstract_info' class='abstract_info abstract_info_group' onclick='$(".abstract_desc").fadeToggle();'>(More info)</div>
          <div id='abstract_title' class='abstract_title abstract_title_group'></div>
          <div id='abstract_desc' class='abstract_desc abstract_desc_group'></div>
        </div>
      </td>
    </tr><tr>
      <th id="options" colspan=2>
        <div class="options-group container_1">
          Tweet&nbsp;with&nbsp;hashtag:&nbsp;{{ config.twitter }}
        </div>
        <div class="options-group container_1">
          Web&nbsp;chat&nbsp;at&nbsp;http://view.streamti.me/{{group}}
        </div>
        <div class="options-group container_1">
          Join&nbsp;IRC&nbsp;on&nbsp;irc://irc.frenode.net/#{{ config.channel }}
        </div>
      </th>
    </tr><tr>
      <td id="twitter-cell" style="height: auto;">
        <div id="twitter-container" class="container_3">
          <div id="twitter-sizer" class="sizer">
            <div id="twitter-juitter">
              <div id="juitterContainer"></div>
            </div>
          </div>
        </div>
      </td>
      <td id="chat-cell" style="width: 60%;">
        <div id="chat-container" class="container_3">
          <div id="chat-sizer" class="sizer">
            {% if screen %}
            <iframe id="chat-frame"
              src="http://webchat.freenode.net?nick=videoscreen-{{group|urlencode}}&channels={{ config.channel|urlencode }}&uio=MTA9dHJ1ZSYxMT0yMzYe4"></iframe>
            {% else %}
            <iframe id="chat-frame" src="http://webchat.freenode.net?channels={{ config.channel|urlencode }}&uio=MTA9dHJ1ZQ49"></iframe>
            {% endif %}
          </div>
        </div>
      </td>
{% endblock %}

{% block script %}
<script type="text/javascript">
function resize() {
 $("#twitter-juitter").height(5);
 $("#twitter-juitter").height($("#twitter-cell").innerHeight()-20);
}
$.Juitter.onUpdate = resize;
$(window).resize(resize);

$(document).ready(function() {
  resize();
  $.Juitter.start({
    live:"live-5",
    total: 20,
    searchType: "searchWord",
    searchObject: "{{ config.twitter|urlencode }}",
    });
});

function schedule_callback() {
  update_schedule($('#abstract_title'), $('#abstract_desc'), '{{config.title|escapejs}}');
  setTimeout(schedule_callback, 60e3);
  resize();
}

get_schedule(schedule_callback);
</script>
{% endblock %}
